{
  "name": "GitHub Readiness",
  "description": "Prepare codebase for public GitHub publication",
  "created": "2026-01-24",
  "stories": [
    {
      "id": "GHR-001",
      "title": "Fix .gitignore and remove tracked artifacts",
      "priority": 1,
      "passes": true,
      "criteria": [
        "grep -q 'stellaris-parser/target/' .gitignore",
        "grep -q '_results.md' .gitignore",
        "! git ls-files --cached | grep -q 'stellaris-parser/target/'",
        "! git ls-files --cached | grep -q '_results.md$'"
      ],
      "notes": "Completed: benchmark_results.md was tracked, removed from index with git rm --cached"
    },
    {
      "id": "GHR-002",
      "title": "Move experiment files to experiments/ directory",
      "priority": 2,
      "passes": true,
      "criteria": [
        "test -d experiments",
        "test -f experiments/test_fresh_stress.py",
        "test -f experiments/test_tool_stress.py",
        "test -f experiments/test_option_a.py",
        "test -f experiments/test_optimized_prompt.py",
        "test -f experiments/test_optimized_vs_production.py",
        "test -f experiments/benchmark_option_b.py",
        "test -f experiments/benchmark_extraction.py",
        "! test -f test_fresh_stress.py",
        "! test -f benchmark_option_b.py"
      ],
      "notes": "Moved 23 experiment files to experiments/. Updated imports to use parent.parent for project root. benchmark_comparison.py never existed (was incorrectly referenced in cleanup findings)"
    },
    {
      "id": "GHR-003",
      "title": "Delete dead personality.py v1 code",
      "priority": 3,
      "passes": true,
      "criteria": [
        "! grep -q 'def build_personality_prompt(' personality.py",
        "! grep -q 'def _build_standard_personality(' personality.py",
        "! grep -q 'def _build_machine_personality(' personality.py",
        "! grep -q 'def _build_hive_mind_personality(' personality.py",
        "! grep -q 'def _build_situational_tone(' personality.py",
        "! grep -q 'def _build_tool_instructions(' personality.py",
        "python3 -c \"from personality import build_optimized_prompt; print('OK')\"",
        "python3 -c \"from personality import load_patch_notes; print('OK')\""
      ],
      "notes": "Deleted ~187 lines of dead v1 code. Kept: load_patch_notes, get_available_patches, _build_machine_optimized, _build_hive_optimized, build_optimized_prompt"
    },
    {
      "id": "GHR-004",
      "title": "Delete or move build_personality_prompt_v2",
      "priority": 3,
      "passes": true,
      "criteria": [
        "! grep -q 'def build_personality_prompt_v2(' personality.py || test -f experiments/test_optimized_vs_production.py",
        "python3 -c \"from personality import build_optimized_prompt; print('OK')\""
      ],
      "notes": "Kept build_personality_prompt_v2 in personality.py because experiments/test_optimized_vs_production.py imports and uses it for A/B comparison tests"
    },
    {
      "id": "GHR-005",
      "title": "Delete deprecated companion.py methods",
      "priority": 3,
      "passes": true,
      "criteria": [
        "! grep -q 'def get_full_briefing(' backend/core/companion.py",
        "! grep -q 'def chat_async(' backend/core/companion.py",
        "python3 -c \"from backend.core.companion import Companion; print('OK')\""
      ],
      "notes": "Deleted get_full_briefing (deprecated wrapper, ~3 lines) and chat_async (never called, ~12 lines). Fixed criterion to use correct class name 'Companion' instead of 'StrategicCompanion'."
    },
    {
      "id": "GHR-006",
      "title": "Add docstrings to conversation.py",
      "priority": 4,
      "passes": true,
      "criteria": [
        "grep -q '\"\"\"' backend/core/conversation.py",
        "python3 -c \"from backend.core.conversation import ConversationManager; print(ConversationManager.__doc__ or 'NO DOC')\" | grep -v 'NO DOC'"
      ],
      "notes": "Added module-level docstring, class docstrings for Turn/Session/ConversationManager, and method docstrings for all public and private methods."
    },
    {
      "id": "GHR-007",
      "title": "Add docstrings to reporting.py",
      "priority": 4,
      "passes": true,
      "criteria": [
        "grep -q '\"\"\"' backend/core/reporting.py",
        "head -20 backend/core/reporting.py | grep -q '\"\"\"'"
      ],
      "notes": "Added docstrings to all 5 functions: _safe_int, _safe_float, _fmt_delta, _extract_report_metrics, build_session_report_text. Module-level docstring already existed."
    },
    {
      "id": "GHR-008",
      "title": "Standardize logging in ingestion_worker.py",
      "priority": 5,
      "passes": true,
      "criteria": [
        "! grep -q 'print(' backend/core/ingestion_worker.py || grep 'print(' backend/core/ingestion_worker.py | grep -q 'file=sys.stderr'",
        "python3 -c \"from backend.core.ingestion_worker import run_worker_job; print('OK')\""
      ],
      "notes": "All 6 print() calls already use file=sys.stderr for timing diagnostics. This is acceptable for worker processes per the established pattern."
    },
    {
      "id": "GHR-009",
      "title": "Run black formatter on Python files",
      "priority": 5,
      "passes": true,
      "criteria": [
        "pip3 show black > /dev/null 2>&1 || pip3 install black",
        "black --check backend/ stellaris_save_extractor/ personality.py save_extractor.py 2>&1 | grep -q 'would be reformatted' && exit 1 || exit 0"
      ],
      "notes": "Formatted 48 files with black 26.1.0. Used project venv (venv/) since system Python is externally managed."
    },
    {
      "id": "GHR-010",
      "title": "Fix hardcoded paths in experiment files",
      "priority": 6,
      "passes": true,
      "criteria": [
        "! grep -q '/Users/avani/' experiments/benchmark_extraction.py",
        "! grep -q '/Users/avani/' experiments/benchmark_option_b.py"
      ],
      "notes": "benchmark_comparison.py never existed. Other experiment files don't have hardcoded paths."
    },
    {
      "id": "GHR-011",
      "title": "Add basic tests for signals.py",
      "priority": 7,
      "passes": true,
      "criteria": [
        "test -f tests/test_signals.py",
        "grep -q 'def test_' tests/test_signals.py",
        "grep -q 'build_snapshot_signals' tests/test_signals.py",
        "python3 -m pytest tests/test_signals.py -v --tb=short 2>&1 | grep -q 'passed'"
      ],
      "notes": "Created 43 tests covering build_snapshot_signals and all 13 extraction functions (_extract_leader_signals, _extract_war_signals, etc.). Uses mock SaveExtractor to avoid needing Rust session or test saves. Also tests helper functions _clean_war_name_part and _resolve_war_name_from_block."
    },
    {
      "id": "GHR-012",
      "title": "Add basic tests for events.py",
      "priority": 7,
      "passes": false,
      "criteria": [
        "test -f tests/test_events.py",
        "grep -q 'def test_' tests/test_events.py",
        "grep -q 'compute_events' tests/test_events.py",
        "python3 -m pytest tests/test_events.py -v --tb=short 2>&1 | grep -q 'passed'"
      ],
      "notes": "At minimum test compute_events with mock snapshots"
    }
  ],
  "patterns": [
    {
      "id": "GHR-P001",
      "learned": "2026-01-24",
      "description": "Verify function usage before marking dead - check full call chain including indirect calls"
    },
    {
      "id": "GHR-P002",
      "learned": "2026-01-24",
      "description": "build_optimized_prompt() is the active production function, not build_personality_prompt() or v2"
    },
    {
      "id": "GHR-P003",
      "learned": "2026-01-24",
      "description": "benchmark_comparison.py was incorrectly referenced in cleanup findings - file never existed. Actual benchmark files are benchmark_extraction.py and benchmark_option_b.py"
    },
    {
      "id": "GHR-P004",
      "learned": "2026-01-24",
      "description": "When moving files to experiments/, update sys.path.insert to use parent.parent and .env paths similarly"
    },
    {
      "id": "GHR-P005",
      "learned": "2026-01-24",
      "description": "build_personality_prompt_v2 is kept in personality.py because it's used by experiments/test_optimized_vs_production.py for A/B comparison tests. The OR-criteria allow keeping it when the experiment file exists."
    },
    {
      "id": "GHR-P006",
      "learned": "2026-01-25",
      "description": "Main companion class is named 'Companion', not 'StrategicCompanion'. Criteria in fix_plan.json should reference the correct class name."
    },
    {
      "id": "GHR-P007",
      "learned": "2026-01-25",
      "description": "ingestion_worker.py already has all print() calls using file=sys.stderr for timing diagnostics. The story was incorrectly marked as failing when the criteria were already satisfied."
    },
    {
      "id": "GHR-P008",
      "learned": "2026-01-25",
      "description": "System Python on macOS is externally managed (PEP 668). Use project venv/ for installing tools like black: 'source venv/bin/activate && pip install black'"
    },
    {
      "id": "GHR-P009",
      "learned": "2026-01-26",
      "description": "For signals.py tests, use mock SaveExtractor instead of requiring Rust session or real test saves. Mock each extractor method (get_leaders, get_wars, etc.) to return expected structures. Tests should verify return structure without hitting actual save files."
    }
  ]
}
